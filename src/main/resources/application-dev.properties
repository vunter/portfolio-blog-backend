# Development Profile - No Docker Required
# Uses H2 in-memory database and disables Redis caching

# Disable Docker Compose integration
spring.docker.compose.enabled=false

# Disable Vault in dev (no Vault server available)
spring.cloud.vault.enabled=false
spring.config.import=

# Allow bean overriding for dev profile
spring.main.allow-bean-definition-overriding=true

# Enable metrics export (Datadog — controlled via DD_METRICS_ENABLED env var)
management.datadog.metrics.export.enabled=${DD_METRICS_ENABLED:true}
management.metrics.export.datadog.enabled=${DD_METRICS_ENABLED:true}

# Enable admin user initialization for E2E testing
admin.user.initialization.enabled=true

# H2 Database (R2DBC compatible) - File-based for persistence across restarts
# DATABASE_TO_LOWER=TRUE creates lowercase identifiers matching @Table/@Column annotations
# CASE_INSENSITIVE_IDENTIFIERS=TRUE ensures quoted identifiers match case-insensitively
spring.r2dbc.url=r2dbc:h2:file:///~/blog-dev;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;CASE_INSENSITIVE_IDENTIFIERS=TRUE
spring.r2dbc.username=sa
spring.r2dbc.password=

# Use H2-compatible schema
app.schema.file=schema-h2.sql
app.schema.init=true

# Disable Redis and use simple caching (DevRedisConfig provides in-memory stubs)
spring.cache.type=simple
spring.autoconfigure.exclude=org.springframework.boot.data.redis.autoconfigure.DataRedisAutoConfiguration,org.springframework.boot.data.redis.autoconfigure.DataRedisReactiveAutoConfiguration,org.springframework.boot.data.redis.autoconfigure.DataRedisRepositoriesAutoConfiguration,org.springframework.boot.mail.autoconfigure.MailHealthContributorAutoConfiguration,io.sentry.spring.boot.jakarta.SentryAutoConfiguration

# Disable mail health indicator in dev (no real SMTP server)
management.health.mail.enabled=false
management.health.redis.enabled=false

# Initialize schema
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:schema-h2.sql

# SEC-03: JWT Secret for development only. Override via JWT_SECRET env var.
# In production, set a cryptographically random 64+ char secret.
jwt.secret=${JWT_SECRET:dev-secret-key-for-local-testing-only-do-not-use-in-production-min-32-chars}

# JWT Cookie settings (not secure in dev since no HTTPS)
jwt.cookie.secure=false
jwt.cookie.domain=

# Logging
logging.level.root=INFO
logging.level.dev.catananti=DEBUG
logging.level.io.r2dbc.h2=DEBUG
logging.file.name=target/app.log

# Enable H2 console for debugging (accessible at /h2-console)
# SEC-10: Restrict to localhost only — never expose externally
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
spring.h2.console.settings.web-allow-others=false

# Disable PostgreSQL FTS in dev (H2 doesn't support to_tsvector)
app.search.use-fts=false

# CORS - allow localhost development
cors.allowed-origins=http://localhost:4200,http://127.0.0.1:4200,http://localhost:3000,http://127.0.0.1:3000

# Disable scheduled tasks in dev to avoid race conditions with schema init
scheduling.refresh-token-cleanup-ms=3600000
scheduling.password-reset-cleanup-ms=21600000
scheduling.metrics-update-ms=300000
app.scheduler.article-publish-rate=300000
cache.warming.refresh-rate-ms=300000

# Disable cache warming in dev
cache.warming.enabled=false

# Enable Swagger UI in dev
springdoc.swagger-ui.enabled=true

# Disable CSRF in dev (no HTTPS, simpler testing)
security.csrf.enabled=false

# Enable actuator env/loggers in dev
management.endpoints.web.exposure.include=health,info,metrics,prometheus,env,loggers
management.endpoint.health.show-details=always

# Override readiness group to exclude Redis (not available in dev)
management.endpoint.health.group.readiness.include=readinessState,db

# Dev admin user for testing (override via env vars: ADMIN_EMAIL, ADMIN_PASSWORD)
admin.email=${ADMIN_EMAIL:admin@localhost.dev}
admin.password=${ADMIN_PASSWORD:changeme-dev-only}
admin.name=${ADMIN_NAME:Dev Admin}

# DevDataInitializer admin password (must match E2E test helpers)
dev.admin.password=${DEV_ADMIN_PASSWORD:Admin123456789!}

# Contact form notification recipient
app.contact.notification-email=${CONTACT_NOTIFICATION_EMAIL:dev@localhost}

# DeepL Translation API key (set via env var DEEPL_API_KEY)
deepl.api-key=${DEEPL_API_KEY:}
