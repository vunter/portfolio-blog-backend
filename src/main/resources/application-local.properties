# ==================== LOCAL PROFILE ====================
# Runs locally against PostgreSQL on rpi5 K3s (NodePort 30432)
# No Redis required - uses simple caching

# === Vault: don't fail if Vault unavailable locally ===
spring.config.import=optional:vault://
spring.cloud.vault.enabled=true
spring.cloud.vault.fail-fast=false

# Disable Docker Compose integration
spring.docker.compose.enabled=false

# Allow bean overriding
spring.main.allow-bean-definition-overriding=true

# Enable metrics export (Datadog — controlled via DD_METRICS_ENABLED env var)
management.datadog.metrics.export.enabled=${DD_METRICS_ENABLED:true}
management.metrics.export.datadog.enabled=${DD_METRICS_ENABLED:true}

# Database — PostgreSQL on rpi5 K3s (NodePort 30432)
spring.r2dbc.url=r2dbc:postgresql://192.168.1.235:30432/blog
spring.r2dbc.username=postgres
# F-006: Password must be provided via environment variable (no hardcoded default)
spring.r2dbc.password=${DATABASE_PASSWORD}

# PostgreSQL schema — don't re-init (data already exists)
app.schema.init=false

# Disable Redis and use simple caching
spring.cache.type=simple
spring.data.redis.enabled=false
spring.autoconfigure.exclude=org.springframework.boot.data.redis.autoconfigure.DataRedisAutoConfiguration,org.springframework.boot.data.redis.autoconfigure.DataRedisReactiveAutoConfiguration,org.springframework.boot.data.redis.autoconfigure.DataRedisRepositoriesAutoConfiguration,org.springframework.boot.mail.autoconfigure.MailHealthContributorAutoConfiguration

# Disable mail health indicator
management.health.mail.enabled=false

# JWT — must be set via environment (F-008: no weak default)
jwt.secret=${JWT_SECRET}
jwt.cookie.secure=false
jwt.cookie.domain=

# Enable PostgreSQL Full-Text Search
app.search.use-fts=true

# Logging
logging.level.root=INFO
logging.level.dev.catananti=DEBUG
logging.file.name=target/app.log

# CORS
cors.allowed-origins=http://localhost:*,http://127.0.0.1:*

# Disable scheduled tasks heavy polling
scheduling.refresh-token-cleanup-ms=3600000
scheduling.password-reset-cleanup-ms=21600000
scheduling.metrics-update-ms=300000
app.scheduler.article-publish-rate=300000
cache.warming.refresh-rate-ms=300000
cache.warming.enabled=false

# Enable Swagger UI
springdoc.swagger-ui.enabled=true

# Disable CSRF
security.csrf.enabled=false

# Actuator
management.endpoints.web.exposure.include=health,info,metrics,prometheus,env,loggers
management.endpoint.health.show-details=always

# Override readiness group to exclude Redis
management.endpoint.health.group.readiness.include=readinessState,db

# Dev admin
admin.email=${ADMIN_EMAIL:admin@localhost.dev}
# F-009: Password must be provided via environment variable (no weak default)
admin.password=${ADMIN_PASSWORD}
admin.name=${ADMIN_NAME:Dev Admin}
admin.user.initialization.enabled=false

# Contact form
app.contact.notification-email=${CONTACT_NOTIFICATION_EMAIL:dev@localhost}

# DeepL Translation API
# F-007: API key must be provided via environment variable (no hardcoded default)
deepl.api-key=${DEEPL_API_KEY:}
